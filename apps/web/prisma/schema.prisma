// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider        = "prisma-client-js"
  previewFeatures = ["referentialIntegrity"]
}

datasource db {
  provider             = "postgresql"
  url                  = env("DATABASE_URL")
  referentialIntegrity = "prisma"
}

model Session {
  id         String   @id @unique @default(uuid()) @db.Uuid
  created_at DateTime @default(now()) @db.Timestamptz(6)
  browser    String?  @db.VarChar(20)
  os         String?  @db.VarChar(20)
  language   String?  @db.VarChar(35)
  country    String?  @db.VarChar(20)
  device     String?  @db.VarChar(20)
  referrer   String?  @db.VarChar(500)

  pageviews PageView[]
  events    Event[]

  @@index([created_at])
}

model PageView {
  id         String   @id @unique @default(uuid()) @db.Uuid
  session_id String
  created_at DateTime @default(now()) @db.Timestamptz(6)
  url        String   @db.VarChar(500)
  session    Session  @relation(fields: [session_id], references: [id], onDelete: Cascade)

  @@index([created_at])
  @@index([session_id])
}

model Event {
  id         String     @id @unique @default(uuid()) @db.Uuid
  session_id String
  created_at DateTime?  @default(now()) @db.Timestamptz(6)
  url        String     @db.VarChar(500)
  type       String     @db.VarChar(50)

  session    Session  @relation(fields: [session_id], references: [id], onDelete: Cascade)
  event_data EventData?

  // TODO: analyze event indexes
  @@index([created_at])
  @@index([session_id])
}

model EventData {
  id         String @id @unique @default(uuid()) @db.Uuid
  event_id   String    @unique
  event_data Json

  event Event @relation(fields: [event_id], references: [id])
}
